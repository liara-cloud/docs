import Layout from "@/components/Layout";
import Button from "@/components/Common/button";
import Section from "@/components/Common/section";
import Alert from "@/components/Common/alert";
import Tabs from "@/components/Common/tab";
import Step from "@/components/Common/step";
import Card from "@/components/Common/card";
import Important from "@/components/Common/important";
import Highlight from "@/components/Common/highlight";
import Link from "next/link";
import NextPage from "@/components/Common/nextpage";

import Head from "next/head";

<Layout>
<Head>
<title>مستندات اتصال به دیتابیس MongoDB در NodeJS - لیارا</title>
<meta property="og:title" content="مستندات خدمات رایانش ابری لیارا" />
<meta property="og:description" content="مستندات مربوط به اتصال به دیتابیس‌ MongoDB در پلتفرم NodeJS در لیارا"  />
</Head>
# اتصال به دیتابیس MongoDB در برنامه‌های NodeJS
<hr className="mb-2" />
<video
    src="https://media.liara.ir/nodejs/nodejs-mongodb.mp4"
    controls="controls"
    className="block w-full"
    width="100%"
></video>
<br />


برای اتصال به دیتابیس MongoDB، می‌توانید از پکیج <Important>mongoose</Important> استفاده کنید، برای نصب این پکیج، کافیست تا در مسیر اصلی پروژه خود، دستور زیر را اجرا کنید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="bash">
        {`npm install mongoose`}
    </Highlight>
</div>
<div className="h-2" />

پس از آن، کافیست تا طبق <a href="/paas/details/envs" className="text-[#2196f3] ">مستندات تنظیم متغیرهای محیطی</a> اطلاعات مربوط به دیتابیس خود را وارد کنید. به عنوان مثال:

<div className="h-2" />
<div dir='ltr'>
    <Highlight className="bash">
        {`MONGODB_URI=mongodb://root:fWy9QPKw8CxTUGCMd6esZSlu@mongo:27017/my-app?authSource=admin`}
    </Highlight>
</div>
<div className="h-2" />

اکنون، می‌توانید متغیر محیطی را در برنامه خود خوانده و به دیتابیس متصل شوید؛ در ادامه، یک قطعه کد مثال برای
اتصال به دیتابیس با استفاده از فریم‌ورک <Important>express</Important> برای شما، قرار گرفته است:

<div className="h-2" />
<div dir='ltr'>
    <Highlight className="js">
        {`const express = require('express');
const mongoose = require('mongoose');

const app = express();

mongoose.connect(process.env.MONGODB_URI, {
})
.then(() => {
  console.log('connected to db successfully');
})
.catch((err) => {
  console.error('error in connecting to db:', err);
});


app.get('/', (req, res) => {
  res.send(mongoose.connection.readyState === 1 ? 'connection to db successfull' : 'error in connecting to db');
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`server is listening on port \${PORT}\`);
});

process.on('SIGINT', () => {
  mongoose.connection.close(() => {
    console.log('db disconnected.');
    process.exit();
  });
});`}
    </Highlight>
</div>

<Section id="connection-pooling" title="استفاده از Connection Pooling" />

مفهوم Connection pooling به معنای استفاده از یک مجموعه اتصالات از پیش ساخته شده برای اتصال به پایگاه داده است. این تکنیک باعث می‌شود به جای ایجاد و بستن مکرر اتصالات، از اتصالات موجود در مجموعه استفاده شود که کارایی را افزایش می‌دهد.
<Alert variant='success'>همچنین بخوانید: <a className="text-[#2196f3] " href="/dbaas/details/connection-pool">آشنایی بیشتر با قابلیت Connection Pooling</a></Alert>

برای استفاده از این قابلیت در دیتابیس MongoDB نیاز به انجام کار خاصی نیست؛ چرا که پکیج <Important>mongoose</Important> به صورت خودکار، از این قابلیت، پشتیبانی می‌کند. صرفاً کافیست تا در آپشن‌های اتصال به دیتابیس، مقدار فیلد <Important>maxPoolSize</Important> را مشخص کنید:
<div className="h-2" />
<div dir='ltr'>
    <Highlight className="js">
        {`const express = require('express');
const mongoose = require('mongoose');

const app = express();

// Create a connection pool
const dbOptions = {
  maxPoolSize: 10, // Set the pool size as needed
};

mongoose.connect(process.env.MONGODB_URI, dbOptions)
  .then(() => {
    console.log('connected to db successfully');
  })
  .catch((err) => {
    console.error('error in connecting to db:', err);
  });

app.get('/', (req, res) => {
  res.send(mongoose.connection.readyState === 1 ? 'connection to db successful' : 'error in connecting to db');
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(\`server is listening on port \${PORT}\`);
});
`}
    </Highlight>
</div>

</Layout>