#!/usr/bin/env sh
echo "Checking for MDX changes in staging area..."

STAGED_MDX_MODIFIED=$(git diff --cached --name-only --diff-filter=AM -- ":(glob)src/pages/**/*.mdx" || true)
STAGED_MDX_DELETED=$(git diff --cached --name-only --diff-filter=D -- ":(glob)src/pages/**/*.mdx" || true)

if [ -n "$STAGED_MDX_MODIFIED" ] || [ -n "$STAGED_MDX_DELETED" ]; then
  if [ -n "$STAGED_MDX_MODIFIED" ]; then
    echo "Found staged modified/added MDX files:"
    echo "$STAGED_MDX_MODIFIED"
  fi

  if [ -n "$STAGED_MDX_DELETED" ]; then
    echo "Found staged deleted MDX files:"
    echo "$STAGED_MDX_DELETED"
  fi

  echo ""
  echo "Converting MDX files to MD..."

  npm run generate-llms:pre-commit

  if [ $? -ne 0 ]; then
    echo "??? MD file generation failed"
    exit 1
  fi

  echo "MD files generated and added to commit"
else
  echo "  No staged MDX changes detected"

  echo " Checking if all MDX files have corresponding MD files..."
  npm run generate-llms:pre-commit

  if [ $? -ne 0 ]; then
    echo " MD file check failed"
    exit 1
  fi
fi

echo "Pre-commit checks passed"
