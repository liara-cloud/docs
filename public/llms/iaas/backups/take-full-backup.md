Original link: https://docs.liara.ir/iaas/backups/take-full-backup/

# تهیه و بازیابی فایل پشتیبان کامل از سرور

در این روش، یک نسخه‌ی کامل از تمام فایل‌ها و تنظیمات سرور ذخیره می‌شود. این نوع بکاپ معمولاً فضای زیادی اشغال می‌کند اما برای بازیابی کل سیستم بسیار مفید است.
روش‌های زیادی برای تهیه فایل پشتیبان کامل از سرور وجود دارد که یکی از معروف‌ترین آن‌ها، استفاده از دستورات `tar` یا `rsync` است.
در ادامه، نحوه تهیه فایل پشتیبان کامل از سرور با استفاده از دستورات `tar` یا `rsync` توضیح داده شده است.

## tar

1. ایجاد دایرکتوری برای بکاپ  
ابتدا باید محلی را برای ذخیره‌ی فایل بکاپ تعیین کنید. فرض کنید دایرکتوری `backup/` محل ذخیره‌ی بکاپ‌ها است؛ پس در ابتدا، این دایرکتوری را، ایجاد کنید.

```bash
mkdir -p /backup
```

2. اجرای دستور tar برای بکاپ‌گیری  
دستور زیر یک فایل آرشیو فشرده‌شده از کل سیستم می‌سازد:

```bash
tar -cvpzf /backup/full_backup_$(date +%F).tar.gz \\
    --exclude=/backup --exclude=/proc --exclude=/tmp --exclude=/sys \\
    --exclude=/dev --exclude=/mnt --exclude=/media --exclude=/run \\
    --exclude=/lost+found /
```

در قطعه کد فوق، فلگ `exclude` برای مشخص کردن فایل‌ها و دایرکتوری‌هایی است که نباید در بکاپ قرار بگیرند. برای مثال، فایل‌های موقتی که در `tmp/` ذخیره می‌شوند، اهمیتی ندارند و نیازی به گرفتن بکاپ از آن‌ها نیست.

3. انتقال بکاپ با `scp`  
برای دانلود فایل بکاپ روی کامپیوتر شخصی خود از دستور زیر، استفاده کنید:

```bash
scp <user>@<your-server-address>:/backup/full_backup_YYYY-DD-MM.tar.gz /local/path/
```

در دستور فوق، به جای `<user>`، نام کاربری SSH خود را و به جای `<your-server-address>`، آدرس سرور خود را وارد کنید. همچنین، به جای `backup/full_backup_YYYY-DD-MM.tar.gz/` مسیر فایل بکاپ روی سرور و به جای `/local/path/` مسیر مورد نظر برای ذخیره‌سازی فایل بکاپ روی کامپیوتر خود را وارد کنید.

اگر فایل بکاپ حجم زیادی دارد، می‌توانید از دستور `rsync` برای انتقال فایل بکاپ استفاده کنید.

```bash
rsync -avz --progress user@your-server:/backup/full_backup_YYYY-DD-MM.tar.gz /local/path/
```

4. بازیابی بکاپ با `tar`  
اگر فایل بکاپ را روی کامپیوتر شخصی دارید و می‌خواهید آن را به سرور برگردانید، از دستور زیر، استفاده کنید:

```bash
scp /local/path/full_backup_YYYY-DD-MM.tar.gz <user>@<your-server>:/backup/
```

در دستور فوق، به جای `local/path/full_backup_YYYY-DD-MM.tar.gz/`، مسیر فایل بکاپ روی کامپیوتر شخصی خود و به جای `<user>`، نام کاربری SSH خود و به جای `<your-server>`، آدرس سرور خود را وارد کنید.

5. بازیابی کامل سیستم  
برای بازیابی کل سیستم از فایل بکاپ، دستور زیر را اجرا کنید:

```bash
tar -xvpzf /backup/full_backup_YYYY-DD-MM.tar.gz -C /
```

اگر می‌خواهید فقط یک دایرکتوری را از بکاپ برگردانید:

```bash
tar -xvpzf /backup/full_backup_YYYY-DD-MM.tar.gz -C / home/user/Documents/
```

5. به‌روزرسانی GRUB بعد از بازیابی  
اگر کل سیستم را بازیابی کرده‌اید، ممکن است `GRUB` نیاز به نصب مجدد داشته باشد:

```bash
grub-install /dev/sda
update-grub
```

## rsync

1. ایجاد دایرکتوری برای بکاپ  
ابتدا باید محلی را برای ذخیره‌ی فایل بکاپ تعیین کنید. فرض کنید دایرکتوری `backup/` محل ذخیره‌ی بکاپ‌ها است؛ پس ابتدا این دایرکتوری را ایجاد کنید.

```bash
mkdir -p /backup
```

2. اجرای دستور rsync برای بکاپ‌گیری  
دستور زیر برای بکاپ‌گیری از کل سیستم به دایرکتوری بکاپ استفاده می‌شود:

```bash
rsync -aAXv --exclude={"/backup","/proc","/tmp","/sys","/dev","/mnt","/media","/run","/lost+found"} / /backup/
```

در این دستور، دایرکتوری‌هایی که نیازی به بکاپ‌گیری ندارند، با `exclude--` حذف شده‌اند.

3. انتقال بکاپ به سیستم دیگر  
برای انتقال فایل‌های بکاپ به یک سرور دیگر از دستور زیر استفاده کنید:

```bash
rsync -aAXv --progress /backup/ user@remote-server:/remote/backup/
```

در این دستور، `user@remote-server` نام کاربری و آدرس سرور مقصد است.

4. بازیابی بکاپ از سرور دیگر  
برای بازگردانی بکاپ از سرور دیگر، دستور زیر را اجرا کنید:

```bash
rsync -aAXv --progress user@remote-server:/remote/backup/ /
```

این دستور، فایل‌های بکاپ را در محل اصلی آن‌ها بازگردانی می‌کند.

5. به‌روزرسانی GRUB بعد از بازیابی  
اگر کل سیستم را بازیابی کرده‌اید، ممکن است `GRUB` نیاز به نصب مجدد داشته باشد:

```bash
grub-install /dev/sda
update-grub
```

## all links

[All links of docs](https://docs.liara.ir/all-links-llms.txt)
